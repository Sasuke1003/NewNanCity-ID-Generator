<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft 牛腩世界身份证生成器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --mc-green: #5b7c3a;
            --mc-dark-green: #3d5a1e;
            --mc-brown: #8b7355;
            --mc-dark-brown: #6f4e37;
            --mc-light: #f0f0f0;
            --mc-dark: #2d2d2d;
            --mc-gray: #5a5a5a;
            --mc-gold: #FFD700;
            --mc-dark-gold: #B8860B;
            --mc-blue: #4169E1;
            --mc-dark-blue: #1E3A8A;
            --mc-red: #FF5555;
            --mc-purple: #9933cc;
            --mc-dark-purple: #6a1b9a;
        }
        
        body {
            background-color: #1a1a1a;
            color: var(--mc-light);
            background-image: linear-gradient(rgba(26, 26, 26, 0.9), rgba(26, 26, 26, 0.9)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="%23333" width="100" height="100"/><rect fill="%23222" width="50" height="50" x="0" y="0"/><rect fill="%23222" width="50" height="50" x="50" y="50"/></svg>');
            min-height: 100vh;
            padding-bottom: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 3px solid var(--mc-gold);
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--mc-gold);
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 var(--mc-dark-gold);
        }
        
        .version-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .version-tab {
            background-color: var(--mc-dark);
            color: var(--mc-light);
            border: 2px solid var(--mc-gold);
            border-radius: 8px 8px 0 0;
            padding: 12px 30px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .version-tab.active {
            background-color: var(--mc-gold);
            color: #333;
        }
        
        .version-tab:hover:not(.active) {
            background-color: rgba(255, 215, 0, 0.2);
        }
        
        .version-content {
            display: none;
        }
        
        .version-content.active {
            display: block;
        }
        
        .instructions-panel {
            background-color: rgba(45, 45, 45, 0.9);
            border: 3px solid var(--mc-gold);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        
        .generated-command {
            display: flex;
            margin-bottom: 20px;
        }
        
        .command-output {
            flex-grow: 1;
            background-color: var(--mc-dark);
            border: 2px solid var(--mc-gray);
            border-radius: 5px 0 0 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            overflow-x: auto;
            color: #4CAF50;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.4;
        }
        
        .copy-btn {
            background-color: var(--mc-gold);
            color: #333;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 0 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background-color: var(--mc-dark-gold);
        }
        
        .copy-btn.copied {
            background-color: #2196F3;
            color: white;
        }
        
        .command-generators {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .command-generators {
                grid-template-columns: 1fr;
            }
        }
        
        .generator-card {
            background-color: rgba(45, 45, 45, 0.9);
            border: 3px solid var(--mc-gold);
            border-radius: 8px;
            padding: 25px;
            transition: transform 0.3s, border-color 0.3s;
        }
        
        .generator-card:hover {
            transform: translateY(-5px);
            border-color: var(--mc-dark-gold);
        }
        
        .card-title {
            color: var(--mc-gold);
            font-size: 1.6rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--mc-dark-gold);
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #ddd;
            font-size: 1.1rem;
        }
        
        .required::after {
            content: " *";
            color: var(--mc-red);
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            background-color: var(--mc-dark);
            border: 2px solid var(--mc-gray);
            border-radius: 6px;
            color: white;
            font-size: 1.1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--mc-gold);
        }
        
        input.error {
            border-color: var(--mc-red);
        }
        
        .error-message {
            color: var(--mc-red);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .generate-btn {
            background-color: var(--mc-gold);
            color: #333;
            border: none;
            border-radius: 6px;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 1.2rem;
            width: 100%;
            transition: background-color 0.3s;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .generate-btn:hover {
            background-color: var(--mc-dark-gold);
        }
        
        .instructions {
            background-color: rgba(45, 45, 45, 0.9);
            border: 2px solid var(--mc-gold);
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            color: var(--mc-gold);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
            font-size: 1.05rem;
        }
        
        .instructions p {
            line-height: 1.6;
            font-size: 1.05rem;
        }
        
        .mc-icon {
            display: inline-block;
            width: 28px;
            height: 28px;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--mc-gray);
            color: #888;
            font-size: 0.9rem;
        }
        
        .book-preview {
            background-color: rgba(30, 30, 30, 0.9);
            border: 3px solid var(--mc-gold);
            border-radius: 8px;
            padding: 25px;
            height: 100%;
        }
        
        .book-preview h3 {
            color: var(--mc-gold);
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.5rem;
        }
        
        .book-title {
            color: var(--mc-gold);
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.4rem;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        
        .book-title .yellow {
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .book-title .white {
            color: white;
        }
        
        .book-content {
            background-color: #f5e9d4;
            color: #3a2c1a;
            border: 2px solid #8b7355;
            border-radius: 5px;
            padding: 25px;
            height: 450px;
            font-size: 1.15rem;
            line-height: 1.6;
            white-space: pre-line;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            box-shadow: inset 0 0 10px rgba(139, 115, 85, 0.3);
            overflow-y: auto;
        }
        
        .book-content .center {
            text-align: center;
            font-weight: bold;
            font-size: 1.3rem;
            display: block;
            margin: 10px 0;
            color: #8B0000;
        }
        
        .book-content .player-id {
            color: #0066cc;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .book-content .date {
            color: #cc3300;
            font-weight: bold;
        }
        
        .book-content .town {
            color: #009933;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .book-content .count {
            color: #9933cc;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .example-btn {
            background-color: var(--mc-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 5px;
            transition: background-color 0.2s;
            width: 100%;
            text-align: center;
        }
        
        .example-btn:hover {
            background-color: var(--mc-dark-blue);
        }
        
        .java-version {
            color: var(--mc-blue);
            font-weight: bold;
        }
        
        .executor-input {
            margin-bottom: 10px;
        }
        
        .executor-input label {
            font-size: 1rem;
        }
        
        .executor-input input {
            padding: 10px;
            font-size: 1rem;
        }
        
        .author-note {
            color: #aaa;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        /* 日历样式 */
        .date-input-container {
            position: relative;
            display: flex;
            gap: 10px;
        }
        
        .date-input-container input {
            flex: 1;
        }
        
        .date-toggle-btn {
            background-color: var(--mc-green);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 14px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
            white-space: nowrap;
        }
        
        .date-toggle-btn:hover {
            background-color: var(--mc-dark-green);
        }
        
        /* 日历选择器样式 - 优化版 */
        .flatpickr-calendar {
            background: #ffffff !important;
            border: 2px solid var(--mc-gold) !important;
            border-radius: 8px !important;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3) !important;
        }
        
        .flatpickr-months {
            background: #f8f8f8 !important;
            border-radius: 6px 6px 0 0 !important;
            padding: 10px 0 !important;
        }
        
        .flatpickr-month {
            color: #333333 !important;
            font-weight: 600 !important;
        }
        
        .flatpickr-weekdays {
            background: #f0f0f0 !important;
            padding: 8px 0 !important;
        }
        
        .flatpickr-weekday {
            color: #555555 !important;
            font-weight: 600 !important;
        }
        
        .flatpickr-day {
            color: #333333 !important;
            font-weight: 500 !important;
            border-radius: 4px !important;
            margin: 2px !important;
        }
        
        .flatpickr-day:hover {
            background: #e0e0e0 !important;
            border-color: #e0e0e0 !important;
        }
        
        .flatpickr-day.today {
            border: 2px solid var(--mc-blue) !important;
            background: transparent !important;
            color: var(--mc-blue) !important;
        }
        
        .flatpickr-day.selected, 
        .flatpickr-day.startRange, 
        .flatpickr-day.endRange, 
        .flatpickr-day.selected.inRange, 
        .flatpickr-day.startRange.inRange, 
        .flatpickr-day.endRange.inRange, 
        .flatpickr-day.selected:focus, 
        .flatpickr-day.startRange:focus, 
        .flatpickr-day.endRange:focus, 
        .flatpickr-day.selected:hover, 
        .flatpickr-day.startRange:hover, 
        .flatpickr-day.endRange:hover {
            background: var(--mc-gold) !important;
            border-color: var(--mc-gold) !important;
            color: #333333 !important;
            font-weight: bold !important;
        }
        
        .flatpickr-day.inRange {
            background: rgba(255, 215, 0, 0.2) !important;
            border-color: rgba(255, 215, 0, 0.3) !important;
        }
        
        .flatpickr-current-month .flatpickr-monthDropdown-months {
            background-color: transparent !important;
            color: #333333 !important;
            font-weight: 600 !important;
            border: 1px solid #ddd !important;
            border-radius: 4px !important;
            padding: 2px 8px !important;
        }
        
        .flatpickr-current-month .flatpickr-monthDropdown-months:hover {
            border-color: var(--mc-gold) !important;
        }
        
        .numInputWrapper span {
            background: #f0f0f0 !important;
            border: 1px solid #ddd !important;
        }
        
        .numInputWrapper span:hover {
            background: #e0e0e0 !important;
        }
        
        .numInputWrapper span.arrowUp:after {
            border-bottom-color: #555555 !important;
        }
        
        .numInputWrapper span.arrowDown:after {
            border-top-color: #555555 !important;
        }
        
        .flatpickr-weekdays span {
            color: #555555 !important;
        }
        
        .flatpickr-time {
            background: #f8f8f8 !important;
            border-top: 1px solid #eee !important;
        }
        
        .flatpickr-time input {
            color: #333333 !important;
            font-weight: 500 !important;
        }
        
        .flatpickr-time .flatpickr-am-pm {
            color: #333333 !important;
        }
        
        .flatpickr-time .flatpickr-am-pm:hover {
            background: #e0e0e0 !important;
        }
        
        /* 旧版样式 */
        .book-title.old-version {
            color: var(--mc-gold);
        }
        
        .book-title.old-version .yellow {
            color: var(--mc-gold);
            font-weight: bold;
        }
        
        .book-title.old-version .white {
            color: white;
        }
        
        .book-content.old-version {
            position: relative;
            background-color: #1a1a1a;
            color: white;
            border: 2px solid var(--mc-gold);
            font-family: 'Courier New', monospace;
        }
        
        .book-content.old-version .lore-text {
            color: var(--mc-purple);
            font-style: italic;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 20px 0;
            padding: 10px;
            border-left: 3px solid var(--mc-purple);
        }
        
        .book-content.old-version .item-type {
            color: #4CAF50;
            font-weight: bold;
            margin: 15px 0;
            padding: 5px;
            background-color: rgba(76, 175, 80, 0.1);
            border-radius: 4px;
        }
        
        .book-content.old-version .hbt-info {
            color: #FFD700;
            font-weight: bold;
            margin: 15px 0;
            padding: 5px;
            background-color: rgba(255, 215, 0, 0.1);
            border-radius: 4px;
        }
        
        .old-version .date-input-container {
            margin-top: 10px;
        }
        
        .item-preview {
            background-color: #2a2a2a;
            border: 2px solid #555;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-id-card mc-icon"></i> Minecraft 牛腩世界身份证生成器</h1>
        </header>
        
        <div class="version-tabs">
            <button class="version-tab active" data-version="new">新版身份证</button>
            <button class="version-tab" data-version="old">旧版身份证</button>
        </div>
        
        <!-- 新版身份证 -->
        <div id="newVersion" class="version-content active">
            <section class="instructions-panel">
                <h2>生成的新版身份证指令</h2>
                <div class="generated-command">
                    <div class="command-output" id="commandOutputNew">请填写下方信息生成身份证指令</div>
                    <button class="copy-btn" id="copyBtnNew">复制</button>
                </div>
            </section>
            
            <div class="command-generators">
                <!-- 身份证生成器 -->
                <div class="generator-card">
                    <h3 class="card-title"><i class="fas fa-id-card"></i> 新版身份证信息填写</h3>
                    
                    <div class="input-group executor-input">
                        <label for="executorNew" class="required">指令执行者</label>
                        <input type="text" id="executorNew" placeholder="执行/give指令的玩家" value="@p">
                        <button class="example-btn" onclick="document.getElementById('executorNew').value = '@p'">示例: @p (当前玩家)</button>
                        <div class="author-note">可以是玩家ID、@p、@a、@r等选择器</div>
                    </div>
                    
                    <div class="input-group executor-input">
                        <label for="authorNew" class="required">书本作者</label>
                        <input type="text" id="authorNew" placeholder="书本作者名字" value="MSA_Sasuke">
                        <div class="author-note">必须为英文字母、数字、下划线组成，不能为空</div>
                        <div class="error-message" id="authorErrorNew">作者名只能包含英文字母、数字和下划线，且不能为空</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="playerIdNew" class="required">身份证持有者ID</label>
                        <input type="text" id="playerIdNew" placeholder="身份证上的玩家ID">
                        <div class="error-message" id="playerIdErrorNew">请输入身份证持有者ID</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="joinDateNew" class="required">入服日期</label>
                        <div class="date-input-container">
                            <input type="text" id="joinDateNew" placeholder="格式：XXXX年XX月XX日" readonly>
                            <button type="button" class="date-toggle-btn" id="calendarToggleNew">
                                <i class="fas fa-calendar-alt"></i> 选择日期
                            </button>
                        </div>
                        <button class="example-btn" onclick="setTodayDate('New')">按下自动输入今日日期</button>
                        <div class="error-message" id="joinDateErrorNew">日期格式不正确或早于2020年2月2日</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="townNew" class="required">所属城镇</label>
                        <input type="text" id="townNew" placeholder="请输入城镇名称" value="牛腩镇">
                        <button class="example-btn" onclick="document.getElementById('townNew').value = '无'">必须为已评为1星城镇或以上的城镇，否则请按此设定为无</button>
                        <div class="error-message" id="townErrorNew">请输入所属城镇</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="reissueCountNew" class="required">补发次数</label>
                        <input type="number" id="reissueCountNew" value="0" min="0" max="99">
                        <button class="example-btn" onclick="document.getElementById('reissueCountNew').value = '0'">示例: 0</button>
                        <div class="error-message" id="reissueCountErrorNew">补发次数不能少于0</div>
                    </div>
                    
                    <button class="generate-btn" id="generateIdCardNew">
                        <i class="fas fa-book"></i> 生成新版身份证指令
                    </button>
                </div>
                
                <!-- 预览区域 -->
                <div class="book-preview">
                    <h3><i class="fas fa-book-open"></i> 新版身份证预览</h3>
                    <div class="book-title">
                        <span class="yellow" id="previewIdNew"></span><span class="white"> 的牛腩世界身份证</span>
                        <div style="font-size: 0.9rem; color: #aaa; margin-top: 5px;">作者: <span id="previewAuthorNew">MSA_Sasuke</span></div>
                    </div>
                    <div class="book-content" id="bookPreviewNew">
                        (请填写左侧信息预览身份证内容)
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 旧版身份证 -->
        <div id="oldVersion" class="version-content">
            <section class="instructions-panel">
                <h2>生成的旧版身份证指令</h2>
                <div class="generated-command">
                    <div class="command-output" id="commandOutputOld">请填写下方信息生成身份证指令</div>
                    <button class="copy-btn" id="copyBtnOld">复制</button>
                </div>
            </section>
            
            <div class="command-generators">
                <!-- 身份证生成器 -->
                <div class="generator-card">
                    <h3 class="card-title"><i class="fas fa-id-card"></i> 旧版身份证信息填写</h3>
                    
                    <div class="input-group executor-input">
                        <label for="executorOld" class="required">指令执行者</label>
                        <input type="text" id="executorOld" placeholder="执行/give指令的玩家" value="@p">
                        <button class="example-btn" onclick="document.getElementById('executorOld').value = '@p'">示例: @p (当前玩家)</button>
                        <div class="author-note">可以是玩家ID、@p、@a、@r等选择器</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="playerIdOld" class="required">身份证持有者ID</label>
                        <input type="text" id="playerIdOld" placeholder="身份证上的玩家ID">
                        <div class="error-message" id="playerIdErrorOld">请输入身份证持有者ID</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="joinDateOld" class="required">入服日期</label>
                        <div class="date-input-container">
                            <input type="text" id="joinDateOld" placeholder="格式：XXXX年XX月XX日" readonly>
                            <button type="button" class="date-toggle-btn" id="calendarToggleOld">
                                <i class="fas fa-calendar-alt"></i> 选择日期
                            </button>
                        </div>
                        <button class="example-btn" onclick="setTodayDate('Old')">按下自动输入今日日期</button>
                        <div class="error-message" id="joinDateErrorOld">日期格式不正确或早于2020年2月2日</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="reissueCountOld" class="required">补发次数</label>
                        <input type="number" id="reissueCountOld" value="0" min="0" max="99">
                        <button class="example-btn" onclick="document.getElementById('reissueCountOld').value = '0'">示例: 0</button>
                        <div class="error-message" id="reissueCountErrorOld">补发次数不能少于0</div>
                    </div>
                    
                    <button class="generate-btn" id="generateIdCardOld">
                        <i class="fas fa-book"></i> 生成旧版身份证指令
                    </button>
                </div>
                
                <!-- 预览区域 -->
                <div class="book-preview">
                    <h3><i class="fas fa-book-open"></i> 旧版身份证预览</h3>
                    <div class="book-title old-version">
                        <span class="yellow" id="previewIdOld"></span><span class="white"> 的牛腩世界身份证</span>
                    </div>
                    <div class="book-content old-version" id="bookPreviewOld">
                        <div class="item-preview">
                            <div class="lore-text" id="previewLoreOld">入服日期：YYYY年MM月DD日</div>
                            <div class="item-type">minecraft:paper</div>
                            <div class="hbt-info">HBT: 1 tag(s)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <section class="instructions">
            <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
            <ul>
                <li><strong>新版身份证</strong>：书本格式，包含完整的身份证信息，需要填写作者、城镇等信息</li>
                <li><strong>旧版身份证</strong>：物品格式，只有玩家ID、入服日期和补发次数信息</li>
                <li><strong>指令执行者</strong>：执行/give指令的玩家，默认为@p（当前玩家），可以是玩家ID或选择器</li>
                <li><strong>身份证持有者ID</strong>：身份证上的玩家名字，必须填写</li>
                <li><strong>入服日期</strong>：格式为"XXXX年XX月XX日"，不能早于2020年2月2日</li>
                <li><strong>所属城镇</strong>：仅新版需要，必须为已评为1星城镇或以上的城镇，否则请设定为无，默认为牛腩镇</li>
                <li><strong>补发次数</strong>：补发次数不能少于0，默认为0</li>
                <li>点击"生成身份证指令"按钮生成指令，点击"复制"按钮复制指令</li>
                <li>在Minecraft游戏中执行指令，即可给指定玩家生成身份证</li>
                <li>右侧可实时预览身份证效果</li>
            </ul>
            <p><strong>注意：</strong>执行指令的玩家需要有OP权限或在开启作弊的世界中。</p>
        </section>
        
        <footer>
            <p>Minecraft | NewNanCity 牛腩小镇 | 牛腩世界身份证生成器</p>
        </footer>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/zh.js"></script>
    <script>
        // 版本切换功能
        document.querySelectorAll('.version-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // 移除所有标签的active类
                document.querySelectorAll('.version-tab').forEach(t => {
                    t.classList.remove('active');
                });
                
                // 隐藏所有版本内容
                document.querySelectorAll('.version-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // 激活当前标签
                this.classList.add('active');
                
                // 显示对应的版本内容
                const version = this.getAttribute('data-version');
                document.getElementById(`${version}Version`).classList.add('active');
                
                // 更新当前活动的版本
                currentVersion = version;
            });
        });
        
        // 当前活动版本
        let currentVersion = 'new';
        let calendarNew, calendarOld;
        
        // 获取当前日期并格式化为中文格式
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}年${month}月${day}日`;
        }
        
        // 设置今日日期到输入框
        function setTodayDate(version) {
            const joinDateInput = document.getElementById(`joinDate${version}`);
            joinDateInput.value = getCurrentDate();
            updateBookPreview(version);
            const errorElement = document.getElementById(`joinDateError${version}`);
            if (errorElement) {
                hideError(joinDateInput, errorElement);
            }
        }
        
        // 验证作者名字格式（英文字母、数字、下划线）- 仅新版需要
        function validateAuthor(authorStr) {
            if (!authorStr || authorStr.trim() === '') return false;
            // 只允许英文字母、数字和下划线
            const pattern = /^[a-zA-Z0-9_]+$/;
            return pattern.test(authorStr);
        }
        
        // 验证日期格式和范围
        function validateDate(dateStr) {
            // 验证格式：XXXX年XX月XX日
            const pattern = /^(\d{4})年(\d{2})月(\d{2})日$/;
            if (!pattern.test(dateStr)) return false;
            
            // 提取年月日
            const match = dateStr.match(pattern);
            const year = parseInt(match[1]);
            const month = parseInt(match[2]);
            const day = parseInt(match[3]);
            
            // 验证日期有效性
            if (month < 1 || month > 12) return false;
            if (day < 1 || day > 31) return false;
            
            // 验证不能早于2020年2月2日
            if (year < 2020) return false;
            if (year === 2020 && month < 2) return false;
            if (year === 2020 && month === 2 && day < 2) return false;
            
            return true;
        }
        
        // 显示/隐藏错误信息
        function showError(inputElement, errorElement, message) {
            inputElement.classList.add('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            return false;
        }
        
        function hideError(inputElement, errorElement) {
            inputElement.classList.remove('error');
            errorElement.style.display = 'none';
            return true;
        }
        
        // 验证表单 - 新版
        function validateFormNew() {
            let isValid = true;
            
            // 验证指令执行者
            const executor = document.getElementById('executorNew').value.trim();
            if (!executor) {
                isValid = showError(document.getElementById('executorNew'), document.getElementById('playerIdErrorNew'), "请输入指令执行者");
            } else {
                hideError(document.getElementById('executorNew'), document.getElementById('playerIdErrorNew'));
            }
            
            // 验证作者名字
            const author = document.getElementById('authorNew').value.trim();
            if (!author) {
                isValid = showError(document.getElementById('authorNew'), document.getElementById('authorErrorNew'), "请输入书本作者");
            } else if (!validateAuthor(author)) {
                isValid = showError(document.getElementById('authorNew'), document.getElementById('authorErrorNew'), "作者名只能包含英文字母、数字和下划线");
            } else {
                hideError(document.getElementById('authorNew'), document.getElementById('authorErrorNew'));
            }
            
            // 验证身份证持有者ID
            const playerId = document.getElementById('playerIdNew').value.trim();
            if (!playerId) {
                isValid = showError(document.getElementById('playerIdNew'), document.getElementById('playerIdErrorNew'), "请输入身份证持有者ID");
            } else {
                hideError(document.getElementById('playerIdNew'), document.getElementById('playerIdErrorNew'));
            }
            
            // 验证入服日期
            const joinDate = document.getElementById('joinDateNew').value.trim();
            if (!joinDate) {
                isValid = showError(document.getElementById('joinDateNew'), document.getElementById('joinDateErrorNew'), "请输入入服日期");
            } else if (!validateDate(joinDate)) {
                isValid = showError(document.getElementById('joinDateNew'), document.getElementById('joinDateErrorNew'), "日期格式不正确或早于2020年2月2日");
            } else {
                hideError(document.getElementById('joinDateNew'), document.getElementById('joinDateErrorNew'));
            }
            
            // 验证所属城镇
            const town = document.getElementById('townNew').value.trim();
            if (!town) {
                isValid = showError(document.getElementById('townNew'), document.getElementById('townErrorNew'), "请输入所属城镇");
            } else {
                hideError(document.getElementById('townNew'), document.getElementById('townErrorNew'));
            }
            
            // 验证补发次数
            const reissueCount = parseInt(document.getElementById('reissueCountNew').value);
            if (isNaN(reissueCount) || reissueCount < 0) {
                isValid = showError(document.getElementById('reissueCountNew'), document.getElementById('reissueCountErrorNew'), "补发次数不能少于0");
            } else {
                hideError(document.getElementById('reissueCountNew'), document.getElementById('reissueCountErrorNew'));
            }
            
            return isValid;
        }
        
        // 验证表单 - 旧版
        function validateFormOld() {
            let isValid = true;
            
            // 验证指令执行者
            const executor = document.getElementById('executorOld').value.trim();
            if (!executor) {
                isValid = showError(document.getElementById('executorOld'), document.getElementById('playerIdErrorOld'), "请输入指令执行者");
            } else {
                hideError(document.getElementById('executorOld'), document.getElementById('playerIdErrorOld'));
            }
            
            // 验证身份证持有者ID
            const playerId = document.getElementById('playerIdOld').value.trim();
            if (!playerId) {
                isValid = showError(document.getElementById('playerIdOld'), document.getElementById('playerIdErrorOld'), "请输入身份证持有者ID");
            } else {
                hideError(document.getElementById('playerIdOld'), document.getElementById('playerIdErrorOld'));
            }
            
            // 验证入服日期
            const joinDate = document.getElementById('joinDateOld').value.trim();
            if (!joinDate) {
                isValid = showError(document.getElementById('joinDateOld'), document.getElementById('joinDateErrorOld'), "请输入入服日期");
            } else if (!validateDate(joinDate)) {
                isValid = showError(document.getElementById('joinDateOld'), document.getElementById('joinDateErrorOld'), "日期格式不正确或早于2020年2月2日");
            } else {
                hideError(document.getElementById('joinDateOld'), document.getElementById('joinDateErrorOld'));
            }
            
            // 验证补发次数
            const reissueCount = parseInt(document.getElementById('reissueCountOld').value);
            if (isNaN(reissueCount) || reissueCount < 0) {
                isValid = showError(document.getElementById('reissueCountOld'), document.getElementById('reissueCountErrorOld'), "补发次数不能少于0");
            } else {
                hideError(document.getElementById('reissueCountOld'), document.getElementById('reissueCountErrorOld'));
            }
            
            return isValid;
        }
        
        // 复制按钮功能
        function setupCopyButton(version) {
            const copyBtn = document.getElementById(`copyBtn${version}`);
            const commandOutput = document.getElementById(`commandOutput${version}`);
            
            copyBtn.addEventListener('click', async () => {
                const text = commandOutput.textContent;
                
                if (text === "请填写下方信息生成身份证指令" || text.includes("请填写所有必填字段")) {
                    alert("请先生成身份证指令！");
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(text);
                    copyBtn.textContent = '已复制!';
                    copyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        copyBtn.textContent = '复制';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('复制失败: ', err);
                    // 备用复制方法
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    copyBtn.textContent = '已复制!';
                    copyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        copyBtn.textContent = '复制';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                }
            });
        }
        
        // 新版身份证生成功能
        document.getElementById('generateIdCardNew').addEventListener('click', () => {
            if (!validateFormNew()) {
                document.getElementById('commandOutputNew').textContent = "请修正表单中的错误后再生成指令";
                return;
            }
            
            generateIdCardNew();
        });
        
        function generateIdCardNew() {
            const executor = document.getElementById('executorNew').value.trim();
            const author = document.getElementById('authorNew').value.trim();
            const playerId = document.getElementById('playerIdNew').value.trim();
            const joinDate = document.getElementById('joinDateNew').value.trim();
            const town = document.getElementById('townNew').value.trim();
            const reissueCount = document.getElementById('reissueCountNew').value;
            
            // 更新预览
            updateBookPreview('New');
            
            // 构建书本内容
            const bookContent = `\\\\n\\\\n      牛腩世界身份证\\\\n\\\\n玩家 ${playerId}\\\\n\\\\n你在 ${joinDate}\\\\n降落在了牛腩世界！\\\\n\\\\n\\\\n\\\\n\\\\n目前所属城镇：${town}\\\\n补发次数：${reissueCount}`;
            
            // 构建书本标题
            const bookTitle = `${playerId} 的牛腩世界身份证`;
            
            // 构建完整的指令
            const command = `/execute run give ${executor} written_book{pages:['[["${bookContent}"]]'],title:"${bookTitle}",author:${author}}`;
            
            document.getElementById('commandOutputNew').textContent = command;
        }
        
        // 旧版身份证生成功能 - 修正版
        document.getElementById('generateIdCardOld').addEventListener('click', () => {
            if (!validateFormOld()) {
                document.getElementById('commandOutputOld').textContent = "请修正表单中的错误后再生成指令";
                return;
            }
            
            generateIdCardOld();
        });
        
        function generateIdCardOld() {
            const executor = document.getElementById('executorOld').value.trim();
            const playerId = document.getElementById('playerIdOld').value.trim();
            const joinDate = document.getElementById('joinDateOld').value.trim();
            
            // 更新预览
            updateBookPreview('Old');
            
            // 构建物品名称（JSON格式，黄色+白色）
            const itemName = `'[{"text":"${playerId}","color":"yellow","bold":false},{"text":" 的牛腩世界身份证","color":"white","bold":false}]'`;
            
            // 构建lore（JSON格式，紫色斜体）
            const lore = `'[{"text":"入服日期：${joinDate}","color":"dark_purple","italic":true}]'`;
            
            // 构建完整的指令 - 修正格式
            const command = `/execute run give ${executor} minecraft:paper{display:{Name:${itemName},Lore:[${lore}]},HBT:1b}`;
            
            document.getElementById('commandOutputOld').textContent = command;
        }
        
        // 更新预览 - 新版
        function updateBookPreviewNew() {
            const playerId = document.getElementById('playerIdNew').value.trim();
            const author = document.getElementById('authorNew').value.trim();
            const joinDate = document.getElementById('joinDateNew').value.trim() || "入服日期";
            const town = document.getElementById('townNew').value.trim() || "所属城镇";
            const reissueCount = document.getElementById('reissueCountNew').value || "0";
            
            // 更新预览标题和作者
            document.getElementById('previewIdNew').textContent = playerId || "";
            document.getElementById('previewAuthorNew').textContent = author || "佚名";
            
            // 构建预览内容
            const previewLines = [
                "\n\n      牛腩世界身份证\n\n",
                playerId ? `玩家 ${playerId}\n\n` : "玩家 \n\n",
                `你在 ${joinDate}\n降落在了牛腩世界！\n\n\n\n\n`,
                `目前所属城镇：${town}\n`,
                `补发次数：${reissueCount}`
            ].join('');
            
            // 显示预览内容
            const bookPreview = document.getElementById('bookPreviewNew');
            bookPreview.textContent = previewLines;
            
            // 高亮显示特定内容
            let htmlContent = previewLines.replace(/\n/g, '<br>');
            
            // 安全地替换高亮内容
            if (previewLines.includes("牛腩世界身份证")) {
                htmlContent = htmlContent.replace(/牛腩世界身份证/g, '<span class="center">牛腩世界身份证</span>');
            }
            
            if (playerId && htmlContent.includes(`玩家 ${playerId}`)) {
                const playerIdRegex = new RegExp(`玩家 ${playerId.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}`, 'g');
                htmlContent = htmlContent.replace(playerIdRegex, `玩家 <span class="player-id">${playerId}</span>`);
            } else if (htmlContent.includes('玩家 ')) {
                htmlContent = htmlContent.replace('玩家 ', '玩家 ');
            }
            
            if (joinDate && htmlContent.includes(`你在 ${joinDate}`)) {
                const escapedJoinDate = joinDate.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const joinDateRegex = new RegExp(`你在 ${escapedJoinDate}`, 'g');
                htmlContent = htmlContent.replace(joinDateRegex, `你在 <span class="date">${joinDate}</span>`);
            }
            
            if (town && htmlContent.includes(`目前所属城镇：${town}`)) {
                const escapedTown = town.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                htmlContent = htmlContent.replace(`目前所属城镇：${town}`, `目前所属城镇：<span class="town">${town}</span>`);
            }
            
            if (reissueCount && htmlContent.includes(`补发次数：${reissueCount}`)) {
                htmlContent = htmlContent.replace(`补发次数：${reissueCount}`, `补发次数：<span class="count">${reissueCount}</span>`);
            }
            
            bookPreview.innerHTML = htmlContent;
        }
        
        // 更新预览 - 旧版
        function updateBookPreviewOld() {
            const playerId = document.getElementById('playerIdOld').value.trim();
            const joinDate = document.getElementById('joinDateOld').value.trim() || "YYYY年MM月DD日";
            
            // 更新预览标题
            document.getElementById('previewIdOld').textContent = playerId || "";
            
            // 更新lore预览
            const loreText = `入服日期：${joinDate}`;
            document.getElementById('previewLoreOld').textContent = loreText;
        }
        
        // 统一的更新预览函数
        function updateBookPreview(version) {
            if (version === 'New') {
                updateBookPreviewNew();
            } else {
                updateBookPreviewOld();
            }
        }
        
        // 初始化日历选择器
        function initCalendar(version) {
            const joinDateInput = document.getElementById(`joinDate${version}`);
            const calendarToggle = document.getElementById(`calendarToggle${version}`);
            
            const calendar = flatpickr(joinDateInput, {
                locale: "zh",
                dateFormat: "Y年m月d日",
                minDate: "2020-02-02",
                maxDate: new Date().fp_incr(365 * 10), // 未来10年
                onChange: function(selectedDates, dateStr, instance) {
                    if (dateStr) {
                        joinDateInput.value = dateStr;
                        updateBookPreview(version);
                        const errorElement = document.getElementById(`joinDateError${version}`);
                        if (errorElement) {
                            hideError(joinDateInput, errorElement);
                        }
                    }
                }
            });
            
            // 点击按钮打开日历
            calendarToggle.addEventListener('click', function() {
                calendar.open();
            });
            
            return calendar;
        }
        
        // 页面加载时初始化
        window.addEventListener('DOMContentLoaded', () => {
            // 设置默认值 - 新版
            document.getElementById('executorNew').value = "@p";
            document.getElementById('authorNew').value = "MSA_Sasuke";
            document.getElementById('playerIdNew').value = "";
            document.getElementById('joinDateNew').value = getCurrentDate();
            document.getElementById('townNew').value = "牛腩镇";
            document.getElementById('reissueCountNew').value = "0";
            
            // 设置默认值 - 旧版
            document.getElementById('executorOld').value = "@p";
            document.getElementById('playerIdOld').value = "";
            document.getElementById('joinDateOld').value = getCurrentDate();
            document.getElementById('reissueCountOld').value = "0";
            
            // 初始化日历
            calendarNew = initCalendar('New');
            calendarOld = initCalendar('Old');
            
            // 初始化预览
            updateBookPreviewNew();
            updateBookPreviewOld();
            
            // 设置复制按钮
            setupCopyButton('New');
            setupCopyButton('Old');
            
            // 输入框变化时更新预览
            ['New', 'Old'].forEach(version => {
                const inputs = version === 'New' ? 
                    ['executorNew', 'authorNew', 'playerIdNew', 'townNew', 'reissueCountNew'] :
                    ['executorOld', 'playerIdOld', 'reissueCountOld'];
                
                inputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    input.addEventListener('input', () => updateBookPreview(version));
                });
                
                // 日期输入框变化时更新预览
                const joinDateInput = document.getElementById(`joinDate${version}`);
                joinDateInput.addEventListener('input', () => updateBookPreview(version));
            });
        });
    </script>
</body>
</html>
